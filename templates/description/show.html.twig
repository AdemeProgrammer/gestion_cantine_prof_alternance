{% extends 'base.html.twig' %}
{% import "_macros/breadcumb.html.twig" as _breadcumb %}

{% block title %}Description{% endblock %}
{% block titre_page %}Détails de la description{% endblock %}
{% block action_page %}
    <a href="{{ path('app_description_edit', {'id': description.id}) }}" class="btn btn-primary">Modifier</a>
{% endblock %}

{% block Breadcrumb %}
    {{ _breadcumb.etape("Description") }}
    {{ _breadcumb.etape("Détails") }}
{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    {# KeenIcons locaux (si non déjà globaux dans base.html.twig) #}
    <link rel="stylesheet" href="{{ asset('assets/vendors/keenicons/duotone/style.css') }}">
    <link rel="stylesheet" href="{{ asset('assets/vendors/keenicons/outline/style.css') }}">
    <link rel="stylesheet" href="{{ asset('assets/vendors/keenicons/solid/style.css') }}">
{% endblock %}

{% block body %}
    <div class="container-xxl py-8">
        <div class="card shadow-sm">
            <div class="card-body">
                <h3 class="mb-6">Description #{{ description.id }}</h3>

                {# Prof / Promo (mêmes règles que l’index) #}
                {% set profTxt = '—' %}
                {% if description.refProfesseur is defined and description.refProfesseur %}
                    {% set p = description.refProfesseur %}
                    {% if p.prenom is defined or p.nom is defined %}
                        {% set profTxt = (p.prenom is defined ? p.prenom ~ ' ' : '') ~ (p.nom is defined ? p.nom : '') %}
                    {% elseif p.email is defined %}
                        {% set profTxt = p.email %}
                    {% else %}
                        {% set profTxt = 'Professeur' %}
                    {% endif %}
                {% endif %}

                {% set promoTxt = '—' %}
                {% set promoHasYears = false %}
                {% if description.refPromo is defined and description.refPromo %}
                    {% set pr = description.refPromo %}
                    {% if pr.anneeDebut is defined and pr.anneeDebut is not null %}
                        {% set y1 = pr.anneeDebut %}
                        {% set y2 = (pr.anneeFin is defined and pr.anneeFin is not null) ? pr.anneeFin : (pr.anneeDebut + 1) %}
                        {% set promoHasYears = true %}
                    {% elseif pr.nom is defined %}
                        {% set promoTxt = pr.nom %}
                    {% else %}
                        {% set promoTxt = 'Promo' %}
                    {% endif %}
                {% endif %}

                <div class="table-responsive mb-6">
                    <table class="table table-row-dashed align-middle">
                        <tbody class="fw-normal text-gray-700">
                        <tr>
                            <th class="fw-normal text-gray-500">Professeur</th>
                            <td class="fw-semibold">{{ profTxt }}</td>
                        </tr>
                        <tr>
                            <th class="fw-normal text-gray-500">Promo</th>
                            <td>
                                {% if promoHasYears %}
                                    <div class="d-flex flex-column lh-1">
                                        <span class="fw-semibold">{{ y1 }}</span>
                                        <span class="text-gray-500">{{ y2 }}</span>
                                    </div>
                                {% else %}
                                    <span class="fw-semibold">{{ promoTxt }}</span>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <th class="fw-normal text-gray-500">Lundi</th>
                            <td>
                                {% if description.lundi %}
                                    <span class="badge badge-light-success p-2">
                      <i class="ki-outline ki-check fs-3"></i>
                    </span>
                                {% else %}
                                    <span class="badge badge-light p-2">
                      <i class="ki-outline ki-minus fs-3 text-gray-500"></i>
                    </span>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <th class="fw-normal text-gray-500">Mardi</th>
                            <td>
                                {% if description.mardi %}
                                    <span class="badge badge-light-success p-2">
                      <i class="ki-outline ki-check fs-3"></i>
                    </span>
                                {% else %}
                                    <span class="badge badge-light p-2">
                      <i class="ki-outline ki-minus fs-3 text-gray-500"></i>
                    </span>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <th class="fw-normal text-gray-500">Mercredi</th>
                            <td>
                                {% if description.mercredi %}
                                    <span class="badge badge-light-success p-2">
                      <i class="ki-outline ki-check fs-3"></i>
                    </span>
                                {% else %}
                                    <span class="badge badge-light p-2">
                      <i class="ki-outline ki-minus fs-3 text-gray-500"></i>
                    </span>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <th class="fw-normal text-gray-500">Jeudi</th>
                            <td>
                                {% if description.jeudi %}
                                    <span class="badge badge-light-success p-2">
                      <i class="ki-outline ki-check fs-3"></i>
                    </span>
                                {% else %}
                                    <span class="badge badge-light p-2">
                      <i class="ki-outline ki-minus fs-3 text-gray-500"></i>
                    </span>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <th class="fw-normal text-gray-500">Vendredi</th>
                            <td>
                                {% if description.vendredi %}
                                    <span class="badge badge-light-success p-2">
                      <i class="ki-outline ki-check fs-3"></i>
                    </span>
                                {% else %}
                                    <span class="badge badge-light p-2">
                      <i class="ki-outline ki-minus fs-3 text-gray-500"></i>
                    </span>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <th class="fw-normal text-gray-500">Report</th>
                            <td class="fw-semibold">
                                {% if description.report is null %}
                                    —
                                {% else %}
                                    {{ description.report|number_format(2, ',', ' ') }} €
                                {% endif %}
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>

                <div class="d-flex flex-wrap gap-2">
                    <a href="{{ path('app_description_index') }}" class="btn btn-light-secondary btn-icon" title="Retour" aria-label="Retour">
                        <i class="ki-outline ki-arrow-left fs-3"></i>
                    </a>
                    <a href="{{ path('app_description_edit', {'id': description.id}) }}" class="btn btn-primary btn-icon" title="Modifier" aria-label="Modifier">
                        <i class="ki-outline ki-pencil fs-3"></i>
                    </a>
                    {{ include('description/_delete_form.html.twig') }}
                </div>
            </div>
        </div>
    </div>
{% endblock %}
